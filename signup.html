<!DOCTYPE html>
<html>
<head>
  <title>ZenoPay Signup</title>
  <script src="js/supabase.js"></script>
</head>

<body>
<h2>Create Account</h2>

<input id="name" placeholder="Full Name"><br>
<input id="email" placeholder="Email"><br>
<input id="password" type="password" placeholder="Password"><br>
<input type="date" id="dob"><br><br>

<label>ID Card Front</label>
<input type="file" id="idFront"><br>

<label>ID Card Back</label>
<input type="file" id="idBack"><br>

<label>Selfie</label>
<input type="file" id="selfie"><br><br>

<button onclick="signup()">Finish & Create Account</button>

<p id="msg"></p>

<script>
async function signup() {

  const { data, error } = await supabase.auth.signUp({
    email: email.value,
    password: password.value
  });

  if (error) {
    msg.innerText = error.message;
    return;
  }

  const userId = data.user.id;

  await supabase.storage.from('id_front')
    .upload(`${userId}.jpg`, idFront.files[0]);

  await supabase.storage.from('id_back')
    .upload(`${userId}.jpg`, idBack.files[0]);

  await supabase.storage.from('selfie')
    .upload(`${userId}.jpg`, selfie.files[0]);

  await supabase.from('profiles').insert({
    id: userId,
    full_name: name.value,
    email: email.value,
    dob: dob.value
  });

  msg.innerText = "Check your email to verify your account.";
  setTimeout(() => location.href = "index.html", 3000);
}
</script>
</body>
</html>
